description: "Test Dynamic Knowledge Graph Prompts"

providers:
  - id: openai:gpt-4o
    config:
      temperature: 0

prompts: file://promptfoo_test_runner.py:create_prompt

tests:
  - description: "test dynamic knowledge graph cypher prompt creates suitable data model"
    vars:
      user_prompt: "[['Identifier (RIC)', 'Company Name', 'Date', 'ESG_score', 'Social_score', 'Gov_score', 'Env_score', 'BVPS', 'Market_cap', 'Shares', 'Industry', 'Net_income', 'RETURN_ON_ASSET', 'QUICK_RATIO', 'ASSET_GROWTH', 'FNCL_LVRG', 'PE_RATIO', 'Scope_1', 'Scope_2', 'CO2_emissions', 'Energy_use', 'Water_use', 'Water_recycle', 'Toxic_chem_red', 'Injury_rate', 'Women_Employees', 'Human_Rights', 'Strikes', 'Turnover_empl', 'Board_Size', 'Shareholder_Rights', 'Board_gen_div', 'Bribery', 'Recycling_Initiatives', 'Total_assets'], ['AAL', 'American Airlines Group Inc', '2021', '59.02910721', '64.28601828', '56.39811612', '54.38515247', '-11.39725006', '10198305438', '644015000', 'Airlines', '-1993000000', '-3.1032', '0.7333', '7.1507', '34.6286', '5.8534', '898.9575031', '6.470219367', '41439616', '551629386', '1873777.95', '', '0', '', '41', '1', '1', '5.8', '10', '1', '20', '1', '0', '66467000000'], ['AAL', 'American Airlines Group Inc', '2020', '69.40117811', '68.81448509', '83.94361492', '56.96600148', '-14.19130047', '10626751115', '483888000', 'Airlines', '-8885000000', '-14.5652', '0.4953', '3.3553', '34.6286', '5.8534', '904.2455266', '7.364001706', '40604000', '540190224', '1729932.37', '', '0', '', '41.618', '1', '0', '5.5', '12', '1', '16.66666667', '1', '0', '62008000000'], ['AAL', 'American Airlines Group Inc', '2019', '69.36922798', '72.44505934', '77.10711045', '58.21814638', '-0.266147604', '10574818306', '444269000', 'Airlines', '1686000000', '2.7966', '0.3045', '-0.9657', '34.6286', '5.8534', '916.4750598', '7.648632162', '39388000', '564200000', '1627726.3', '', '0', '41.872', '41.654', '1', '1', '4.242', '13', '1', '15.38461538', '1', '0', '59995000000'], ['AAL', 'American Airlines Group Inc', '2018', '71.63302219', '72.04574143', '83.06962314', '60.68373547', '-0.36403898', '11198012018', '465660000', 'Airlines', '1412000000', '2.4911', '0.3573', '14.7675', '34.6286', '7.0665', '969.3836879', '9.117632405', '39279000', '562000000', '1767786.47', '', '0', '41.942', '42.452', '1', '0', '5.613', '13', '1', '15.38461538', '1', '0', '60580000000'], ['AAL', 'American Airlines Group Inc', '2017', '69.79137149', '73.98311797', '78.63204572', '56.14422918', '-1.594557245', '11334335643', '491692000', 'Airlines', '2105000000', '2.464', '0.4439', '2.9469', '34.6286', '9.8649', '1015.247621', '10.31959014', '42038000', '617300000', '1608799.25', '', '0', '30.7', '42.505', '1', '0', '7.139', '13', '1', '15.38461538', '1', '0', '52785000000'], ['AAL', 'American Airlines Group Inc', '2016', '70.3178445', '78.15023537', '71.82041582', '58.46912521', '6.853060249', '11009755584', '556099000', 'Airlines', '2584000000', '5.3687', '0.5733', '5.9052', '10.5827', '8.1442', '979.2028136', '12.16881594', '42282000', '619000000', '1767786.47', '', '0', '38.95', '42', '1', '0', '', '11', '1', '9.090909091', '1', '0', '51274000000'], ['AAL', 'American Airlines Group Inc', '2015', '51.79390641', '54.30943132', '35.94845361', '62.8321256', '8.430668783', '10802024347', '687355000', 'Airlines', '7610000000', '16.6085', '0.5644', '12.0069', '11.9697', '4.2243', '1581.72232', '', '42300000', '', '', '56781.15', '0', '', '41', '0', '0', '', '12', '1', '8.333333333', '1', '0', '48415000000'], ['AAL', 'American Airlines Group Inc', '2014', '44.30935231', '52.95317347', '34.85299977', '41.3372859', '2.816897482', '11314860839', '734016000', 'Airlines', '2882000000', '6.7413', '0.677', '2.2399', '28.1404', '10.4955', '1074.834037', '18.58780929', '27177000', '389700000', '1935858.67', '98420.66', '0', '', '41', '0', '1', '', '11', '1', '18.18181818', '1', '0', '43225000000'], ['AAL', 'American Airlines Group Inc', '2013', '46.85202135', '51.25924607', '31.05261636', '55.31655844', '-16.74987427', '11600491291', '163046000', 'Airlines', '-1834000000', '-5.5755', '0.7831', '79.8299', '28.1404', '', '1128.904458', '19.30856166', '27533000', '394700000', '2018280.61', '', '0', '', '39', '0', '0', '', '11', '1', '18.18181818', '1', '0', '42278000000'], ['AAL', 'American Airlines Group Inc', '2012', '51.24684551', '70.86964887', '24.12375195', '49.64136041', '-63.778138', '11797714591', '125231000', 'Airlines', '-1876000000', '-7.9226', '0.5391', '-1.4173', '28.1404', '', '', '', '27400000', '469631498', '2022924', '', '1', '', '39', '0', '0', '', '12', '1', '16.66666667', '1', '0', '23510000000'], ['ALK', 'Alaska Air Group Inc', '2021', '50.48254945', '39.63992514', '86.0630969', '32.64819037', '30.39268209', '6474416945', '126775000', 'Airlines', '464000000', '3.4147', '0.9176', '-0.6763', '4.1239', '10.5475', '905.4543902', '2.884637285', '7976125', '107090478', '59089.504', '', '0', '28.803', '', '1', '0', '', '12', '1', '41.66666667', '1', '0', '13951000000'], ['ALK', 'Alaska Air Group Inc', '2020', '54.76478447', '44.82792507', '87.86701992', '37.97117517', '24.20413123', '6625511856', '123450000', 'Airlines', '-1324000000', '-9.7933', '0.8912', '8.1044', '3.6944', '10.5475', '937.9543804', '1.300096805', '7761999', '112275897', '61424.924', '', '0', '27.16', '', '1', '0', '', '12', '1', '41.66666667', '1', '0', '14046000000'], ['ALK', 'Alaska Air Group Inc', '2019', '54.78086974', '47.53378754', '83.23838167', '38.60978203', '35.13169315', '6590256377', '124289000', 'Airlines', '769000000', '6.4338', '0.5761', '19.0707', '2.9578', '10.5475', '949.2740056', '1.254877122', '7503475', '108025619.5', '63348.931', '', '0', '27.506', '', '1', '0', '', '11', '1', '36.36363636', '1', '0', '12993000000'], ['ALK', 'Alaska Air Group Inc', '2018', '61.10430324', '55.14174196', '89.29964586', '43.45236925', '30.43901647', '7068723596', '123975000', 'Airlines', '437000000', '4.0355', '0.5445', '1.5448', '3.0035', '13.6321', '858.5817722', '2.115780591', '5099633', '73414401', '68202.958', '', '0', '32.976', '54', '1', '0', '', '10', '1', '40', '1', '0', '10912000000'], ['ALK', 'Alaska Air Group Inc', '2017', '64.76905583', '67.17896047', '85.4188325', '42.77115416', '28.08190827', '7248778365', '123854000', 'Airlines', '723000000', '9.2718', '0.7305', '7.8699', '3.2402', '11.512', '862.8063594', '1.878885316', '4840510', '69695200', '82806.8', '', '0', '32.853', '54', '0', '0', '', '11', '1', '45.45454545', '1', '0', '10746000000'], ['ALK', 'Alaska Air Group Inc', '2016', '55.66218011', '51.08911554', '87.34169898', '32.98313322', '23.72184498', '7076278341', '124389000', 'Airlines', '797000000', '9.5683', '0.7424', '52.5574', '3.0872', '12.3738', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '9962000000'], ['ALK', 'Alaska Air Group Inc', '2015', '', '', '', '', '18.78120789', '7028431619', '129372000', 'Airlines', '848000000', '13.4667', '0.8532', '7.6847', '2.7752', '12.0625', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '6533000000'], ['ALK', 'Alaska Air Group Inc', '2014', '', '', '', '', '15.70379121', '7281515596', '136801000', 'Airlines', '605000000', '10.1664', '0.8833', '3.8712', '2.8638', '14.7979', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '6064000000'], ['ALK', 'Alaska Air Group Inc', '2013', '', '', '', '', '14.50217997', '7402391525', '141878000', 'Airlines', '508000000', '8.9571', '0.938', '6.049', '3.2878', '13.6386', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '5838000000'], ['ALK', 'Alaska Air Group Inc', '2012', '', '', '', '', '10.04836794', '7414982767', '143568000', 'Airlines', '316000000', '5.922', '0.9207', '6.5415', '4.1125', '9.1566', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '5505000000'], ['ALLE', 'Allegion PLC', '2021', '73.40375216', '83.38290372', '66.44580957', '68.26787654', '8.443826474', '10385605328', '90500000', 'Building Products', '483300000', '15.7833', '1.1331', '-0.5995', '3.8529', '24.4624', '', '', '100618', '408600', '394439.722', '', '1', '1.95', '36', '1', '0', '', '8', '1', '12.5', '1', '0', '3051000000'], ['ALLE', 'Allegion PLC', '2020', '59.52521192', '62.27435928', '67.24358974', '41.10701352', '8.985915493', '10355606978', '92800000', 'Building Products', '314500000', '10.4131', '1.5383', '3.4443', '3.8043', '22.7661', '', '', '', '', '', '', '1', '', '', '1', '0', '', '7', '1', '28.57142857', '1', '0', '3069400000'], ['ALLE', 'Allegion PLC', '2019', '59.57897254', '59.97902967', '67.4', '45.07902049', '8.091880342', '10113855566', '94300000', 'Building Products', '402100000', '13.9094', '1.3513', '5.5868', '4.1021', '25.4909', '8.628692755', '28.83442545', '102338', '462330', '', '', '1', '', '', '1', '0', '', '7', '1', '28.57142857', '1', '0', '2967200000'], ['ALLE', 'Allegion PLC', '2018', '47.47726304', '58.84089693', '45.47619048', '31.17791234', '6.852631579', '10104150218', '95700000', 'Building Products', '413500000', '16.2513', '1.1688', '10.5507', '5.0847', '17.1241', '', '', '', '', '', '', '1', '', '', '1', '0', '', '7', '1', '28.57142857', '1', '0', '2810200000'], ['ALLE', 'Allegion PLC', '2017', '37.20505888', '43.26741466', '46.33333333', '10.51693405', '4.222923239', '10155323874', '96000000', 'Building Products', '329000000', '11.4127', '1.6554', '13.1085', '9.3016', '21.1839', '', '', '', '', '', '', '1', '', '', '1', '0', '', '6', '1', '16.66666667', '1', '0', '2542000000'], ['ALLE', 'Allegion PLC', '2016', '33.00965314', '46.7541872', '36.17886179', '3.431372549', '1.182672234', '9855340371', '96900000', 'Building Products', '231200000', '10.1587', '1.3324', '-0.6894', '32.4723', '19.1713', '8.827909676', '28.74474155', '77704', '', '', '', '0', '', '', '1', '0', '', '6', '1', '16.66666667', '1', '0', '2247400000'], ['ALLE', 'Allegion PLC', '2015', '28.54361028', '30.94209162', '38.50877193', '6.77244582', '0.266944734', '9666527226', '96900000', 'Building Products', '154700000', '7.1934', '1.1253', '12.2576', '205.7163', '21.7584', '', '', '', '', '', '', '0', '', '', '0', '0', '', '6', '1', '16.66666667', '1', '0', '2263000000'], ['ALLE', 'Allegion PLC', '2014', '41.9183995', '32.57938447', '73.05555556', '3.267973856', '-0.049947971', '10015037471', '97200000', 'Building Products', '183700000', '8.724', '0.9782', '0.7648', '3.1199', '21.3734', '', '', '', '', '', '', '0', '', '', '0', '0', '', '5', '1', '20', '1', '0', '2015900000'], ['ALLE', 'Allegion PLC', '2013', '', '', '', '', '-0.688541667', '10069740345', '96100000', 'Building Products', '48400000', '1.6213', '0.9937', '0.8469', '3.1199', '26.9942', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '2000600000'], ['ALLE', 'Allegion PLC', '2012', '', '', '', '', '13.99166667', '10110326349', '96000000', 'Building Products', '230000000', '10.9502', '1.5827', '-2.5734', '1.4581', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '1983800000'], ['AME', 'AMETEK Inc', '2021', '48.43311116', '50.37985133', '64.36906602', '33.0261549', '29.75421186', '30364402028', '232813000', 'Electrical Equipment', '990053000', '8.8971', '0.7522', '14.8753', '1.7358', '34.7739', '', '', '', '', '', '', '0', '', '', '0', '0', '', '8', '1', '37.5', '1', '0', '11898187000'], ['AME', 'AMETEK Inc', '2020', '46.57431694', '50.92936263', '58.75348611', '31.66671862', '25.93042038', '30350499974', '231150000', 'Electrical Equipment', '872439000', '8.6371', '1.6826', '5.2102', '1.8258', '27.7144', '', '', '', '', '', '', '0', '', '', '0', '0', '', '9', '1', '33.33333333', '1', '0', '10357483000'], ['AME', 'AMETEK Inc', '2019', '42.26573632', '40.45126171', '65.38635236', '24.98103781', '22.46010915', '29516376759', '229395000', 'Electrical Equipment', '861297000', '9.3079', '0.798', '13.6485', '1.9778', '26.7282', '', '', '', '', '', '', '0', '', '', '0', '0', '', '9', '1', '33.33333333', '1', '0', '9844559000'], ['AME', 'AMETEK Inc', '2018', '26.17277106', '29.15026235', '26.42022008', '22.71337861', '18.37738007', '30072458902', '232712000', 'Electrical Equipment', '766133000', '9.4534', '0.8634', '11.111', '1.9902', '20.5798', '', '', '', '', '', '', '0', '', '', '0', '0', '', '9', '1', '33.33333333', '1', '0', '8662288000'], ['AME', 'AMETEK Inc', '2017', '30.66502908', '29.55969049', '44.8033748', '20.09075908', '17.49402986', '30090994974', '231845000', 'Electrical Equipment', '589870000', '9.1493', '1.1544', '9.7933', '2.0451', '27.7205', '', '', '', '', '', '', '0', '', '', '0', '0', '', '9', '1', '33.33333333', '1', '0', '7796064000'], ['AME', 'AMETEK Inc', '2016', '33.20225163', '26.6121386', '56.66255398', '20.85230835', '14.00090716', '29567350956', '233730000', 'Electrical Equipment', '512158000', '7.4435', '1.4166', '6.6095', '2.1135', '21.136', '', '', '', '', '', '', '0', '', '', '0', '0', '', '8', '1', '25', '1', '0', '7100674000'], ['AME', 'AMETEK Inc', '2015', '32.44116267', '29.91329851', '53.04810997', '18.03063224', '13.56625512', '28909320420', '241586000', 'Electrical Equipment', '590859000', '9.0336', '0.9612', '3.7298', '2.0143', '20.998', '', '', '', '', '', '', '0', '', '', '0', '0', '', '7', '1', '14.28571429', '1', '0', '6660450000'], ['AME', 'AMETEK Inc', '2014', '29.54343011', '33.91813565', '37.77892207', '17.90074928', '13.22890745', '29527961804', '247102000', 'Electrical Equipment', '584460000', '9.5043', '1.0288', '9.239', '1.929', '21.6921', '', '', '', '', '', '', '0', '', '', '0', '0', '', '7', '1', '14.28571429', '1', '0', '6420963000'], ['AME', 'AMETEK Inc', '2013', '25.66447145', '33.68505357', '27.27989037', '15.55506041', '12.85743394', '29708688500', '246065000', 'Electrical Equipment', '516999000', '9.3423', '0.9512', '13.2532', '1.9516', '25.4523', '', '', '', '', '', '', '0', '', '', '0', '0', '', '7', '1', '14.28571429', '1', '0', '5877902000'], ['AME', 'AMETEK Inc', '2012', '12.24247583', '22.79737658', '10.33164129', '2.302631579', '10.49699808', '29731858590', '243986000', 'Electrical Equipment', '459132000', '9.6562', '0.7567', '20.1544', '2.0727', '19.984', '', '', '', '', '', '', '0', '', '', '0', '0', '', '8', '1', '12.5', '1', '0', '5190056000'], ['AOS', 'A O Smith Corp', '2021', '54.00154295', '46.2908336', '58.07782524', '59.02930495', '11.45792209', '10784338541', '161319900', 'Building Products', '487100000', '14.6825', '1.1314', '9.925', '1.8028', '29.695', '22.00053463', '24.36361814', '138754', '2030842.8', '1370806.738', '', '0', '', '42', '1', '0', '', '10', '1', '20', '1', '0', '3474400000'], ['AOS', 'A O Smith Corp', '2020', '52.04805145', '41.10365709', '56.74584021', '60.09099171', '11.44241472', '10897395090', '162604150', 'Building Products', '344900000', '11.0924', '1.4381', '3.3584', '1.7691', '25.3944', '20.7663352', '24.32416324', '143744', '1902160.8', '964340.768', '', '0', '', '', '1', '0', '', '10', '1', '20', '1', '0', '3160700000'], ['AOS', 'A O Smith Corp', '2019', '41.56413871', '32.65950433', '58.37558372', '37.28373876', '10.07431591', '10462441424', '166710900', 'Building Products', '370000000', '12.0728', '1.4885', '-0.4395', '1.8114', '21.4595', '22.10197884', '27.59135049', '148916', '1894870.8', '1048918.184', '', '0', '', '', '1', '0', '', '11', '1', '18.18181818', '1', '0', '3058000000'], ['AOS', 'A O Smith Corp', '2018', '40.35379016', '34.81925394', '54.62287941', '34.50987574', '10.06510664', '10768636243', '172194040', 'Building Products', '444200000', '14.1715', '1.6456', '-3.9376', '1.8647', '16.1191', '', '', '', '', '', '', '0', '', '', '0', '0', '', '10', '1', '20', '1', '0', '3071500000'], ['AOS', 'A O Smith Corp', '2017', '39.21154111', '31.54732662', '60.62491062', '29.74093049', '9.526481348', '10895824860', '174605190', 'Building Products', '378300000', '9.7398', '1.7797', '10.5984', '1.9266', '35.9134', '', '', '', '', '', '', '0', '', '', '0', '0', '', '10', '1', '10', '1', '0', '3197400000'], ['AOS', 'A O Smith Corp', '2016', '26.94238012', '27.99118757', '50.88011516', '5.848348348', '8.673096881', '10641447626', '176825280', 'Building Products', '326500000', '11.8293', '1.6631', '9.9574', '1.8664', '25.4379', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '2891000000'], ['AOS', 'A O Smith Corp', '2015', '', '', '', '', '8.120039896', '10660290384', '179009180', 'Building Products', '282900000', '10.9982', '1.7554', '4.5283', '1.822', '24.5036', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '2629200000'], ['AOS', 'A O Smith Corp', '2014', '', '', '', '', '7.648944406', '10917808078', '181973960', 'Building Products', '207800000', '8.4699', '1.6809', '5.1767', '1.8106', '24.7412', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '2515300000'], ['AOS', 'A O Smith Corp', '2013', '', '', '', '', '7.211933413', '11180036461', '185575340', 'Building Products', '169700000', '7.2672', '1.5987', '4.9456', '1.8512', '27.8981', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '2391500000']]"
      system_prompt_template: "generate-knowledge-graph-model"
    assert:
      - type: is-json
        value:
          required:
            - model
          type: object
          properties:
            model:
              type: object
              required:
                - Company
                - Industry
                - Report
                - Environment
                - Social
                - Governance
              properties:
                Company:
                  type: object
                  required:
                  - attributes
                  - relationships
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                      required:
                        - has_report
                      properties:
                        has_report:
                          type: object
                          required:
                            - attributes
                          properties:
                            attributes:
                              type: object
                              required:
                                - Date
                              properties:
                                Date:
                                  type: string
                    type:
                      type: string
                Industry:
                  type: object
                  required:
                    - attributes
                    - relationships
                    - type
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                    type:
                      type: string
                Report:
                  type: object
                  required:
                    - attributes
                    - relationships
                    - type
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                      required:
                        - has_ESG_Environment
                        - has_ESG_Social
                        - has_ESG_Governance
                    type:
                      type: string
                Environment:
                  type: object
                  required:
                    - attributes
                    - relationships
                    - type
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                    type:
                      type: string
                Social:
                  type: object
                  required:
                    - attributes
                    - relationships
                    - type
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                    type:
                      type: string
                Governance:
                  type: object
                  required:
                    - attributes
                    - relationships
                    - type
                  properties:
                    attributes:
                      type: array
                    relationships:
                      type: object
                    type:
                      type: string
      - type: contains-all
        value:
          - "Identifier"
          - "Company Name"
          - "ESG_score"
          - "Social_score"
          - "Gov_score"
          - "Env_score"
          - "BVPS"
          - "Market_cap"
          - "Shares"
          - "Industry"
          - "Net_income"
          - "RETURN_ON_ASSET"
          - "QUICK_RATIO"
          - "ASSET_GROWTH"
          - "FNCL_LVRG"
          - "PE_RATIO"
          - "Scope_1"
          - "Scope_2"
          - "CO2_emissions"
          - "Energy_use"
          - "Water_use"
          - "Water_recycle"
          - "Toxic_chem_red"
          - "Injury_rate"
          - "Women_Employees"
          - "Human_Rights"
          - "Strikes"
          - "Turnover_empl"
          - "Board_Size"
          - "Shareholder_Rights"
          - "Board_gen_div"
          - "Bribery"
          - "Recycling_Initiatives"
          - "Total_assets"